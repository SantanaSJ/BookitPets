# hotels
INSERT INTO `properties` (id, address, category, city, image_url, name, postal_code, type_id, check_in_time,
                          check_out_time, description, lat, lng)
VALUES (1, '4 Narodno sabranie', 5, 'Sofia',
        'https://digital.ihg.com/is/image/ihg/intercontinental-sofia-5488872488-2x1?wid=1440&fit=fit,1',
        'InterContinental Sofia', 1000, 1, '15:00', '12:00', 'Located in the heart of Sofia, InterContinental Sofia offers two restaurants,
        a 24/7 fitness centre and city and mountain views. The hotel’s location provides easy access to the main historical and cultural buildings,
        as well as to the shopping area. Among the facilities at this property are a concierge service and ticket service, along with free WiFi throughout the property.
        The accommodation features a 24-hour front desk, room service and currency exchange for guests.', '42.69327', '23.33212'),
       (2, '11 Brussels, Blvd.', 4, 'Sofia',
        'https://pix8.agoda.net/hotelImages/4843379/-1/f3fd0b7aa01da8aed8f4c6ab6cf7c007.jpg?ca=0&ce=1&s=1024x768',
        'Best Western Premier Sofia Airport Hotel', 1592, 1, '15:00', '12:00', 'The modern 4-star Best Western Premier Sofia Airport Hotel is located in a new business district,
        only 750 m away by car from Sofia International Airport Terminal 1 and 1 km from Sofia International Airport Terminal 2. It is 900 m away from Sofia Airport Centre and 2.3 km away from Trade Center Europe.
        The hotel offers room service by a robot. Roomy the robot butler''s assistance consists of delivering food, beverages and room amenities. An onsite Grab&Go early breakfast is offered for guests from 03:00 to 07:00,
        and a buffet breakfast is available in the Barillon 1909 restaurant from 07:00 to 10:00.', '42.69327', '23.33212'),
       (3, '46 Hristo Belchev str.', 3, 'Sofia',
        'https://q-xx.bstatic.com/xdata/images/hotel/840x460/59123177.jpg?k=637ee48140339b496ad0c4f25abc059a58e25b27851d0e0516601967878bc76e&o=',
        'Best Western Art Plaza Hotel', 1000, 1, '15:00', '12:00', 'Art Plaza Hotel is located in the city centre of Sofia. Vitosha boulevard pedestrian street with cafes and shops is a 1-minute walk away.
        Free WiFi access is available at the property. Each room here will provide you with a TV, air conditioning and cable channels. There is also an electric kettle.
        Featuring a hairdryer, private bathroom also comes with bathrobes and free toiletries. Extras include bed linen. At Art Plaza Hotel you will find a 24-hour front desk. Other facilities offered at the property include luggage storage.
        Complimentary coffee and tea facilities, as well as a business center with copy machine are at guests disposal.', '42.69327', '23.33212'),
       (4, 'Maria Luiza 131 Blvd,', 4, 'Sofia',
        'https://q-xx.bstatic.com/xdata/images/hotel/840x460/56567025.jpg?k=fb78488aa6e14d2cabc47680fef6229f4f8649ec40ac2eb40aa1c53843b5334a&o=',
        'Ramada by Wyndham Sofia City Center', 1000, 1, '15:00', '12:00', 'The Ramada by Wyndham Sofia City Center is situated within walking distance to tourist sights and commercial areas of the city, offering comfortable rooms in a modern building.
        Free WiFi is available in all areas.
        Being 12 km from Sofia International Airport, near to Central Railway and International Bus Station, the hotel enjoys a convenient location and won the Bulgaria''s 2009 Best Convention Hotel prize.
        An airport shuttle service is available on request and for a surcharge.', '42.69327', '23.33212'),
       (5, '52, Hristo Botev Blvd.', 4, 'Sofia', 'https://central-hotel.com/wp-content/uploads/2014/12/histori.jpg',
        'Central Hotel Sofia', 1000, 1, '15:00', '12:00', 'Central Hotel Sofia offers accommodation in the heart of Sofia. The hotel has an underground valet parking at a surcharge and a relax centre with a hot tub,
        a sauna, a steam bath and a relax zone. Guests can enjoy a meal at the on site restaurant. Free WiFi is at guests disposal. Shuttle services can be organized upon request and at a surcharge.','42.69327', '23.33212'),
       (6, '2a, Makedonia blvd', 1, 'Sofia',
        'https://pix8.agoda.net/hotelImages/261/261128/261128_1212021023008873354.jpg?ca=0&ce=1&s=1024x768',
        'Hostel Mostel Sofia', 1606, 3, '15:00', '12:00', 'Hostel Mostel Sofia is set in a renovated building from the 19th century, enjoying a quiet location in the centre of Sofia. A modern, shared kitchen is at guests’ disposal.
        Serdika underground railway station is a 10-minute walk away.
        The comfortably furnished rooms have private and shared facilities. All rooms have access to free Wi-Fi and shared computers are available upon request. Guests may use the common living room which features a billiard table.
        A communal washing machine and dryer are available, while lockers are provided in the dormitory rooms. Hairdryer and ironing facilities are upon request.', '42.69327', '23.33212'),
       (7, '8 Tri ushi street', 4, 'Sofia',
        'https://cf.bstatic.com/xdata/images/hotel/max1280x900/240252483.jpg?k=3a9b61176e4c68be19f28d09b94087cda7b2cfc37b28fc0ebb5be145df58bafc&o=&hp=1',
        'Sofia Palace Hotel by HMG', 1000, 1, '15:00', '12:00', 'Situated in Sofia, 300 m from the main shopping street Vitosha, Sofia Palace Hotel by HMG features accommodation with a restaurant, private parking, a fitness centre and a bar.
        The property is set 1.5 km from Ivan Vazov Theater, 2 km from Cathedral Saint Alexandar Nevski and 2.8 km from NDK. The accommodation offers a 24-hour front desk, airport transfers, room service and free WiFi throughout the property.',
        '42.69327', '23.33212'),
       (8, 'Sofia City Center', 3, 'Sofia',
        'https://q-xx.bstatic.com/xdata/images/hotel/840x460/272096959.jpg?k=9165a019634a9446e79adda58279427819bedf8a54c5a2e92fa189a23644d1fa&o=',
        'Hotel Budapest', 1000, 1, '15:00', '12:00', 'Budapest Hotel is within a 5-minute walk from the Central Train Station, in the very centre of Sofia. All rooms feature free Wi-Fi access. The metro station Luvov Most is within a 5-minute walk away.
        The Budapest Restaurant serves buffet and à la carte dishes. Guests can choose among modern Bulgarian and Hungarian cuisine. In the lobby bar there is a wide range of refreshments, cocktails, snacks and desserts on offer.', '42.69327', '23.33212'),
       (9, '1, Gourko Str.', 5, 'Sofia',
        'https://q-xx.bstatic.com/xdata/images/hotel/840x460/323358408.jpg?k=26e647a67ebb6dd51f6fcb0e42e422b99d63991c4fcde6b6225bcfd3407a8e18&o=',
        'Grand Hotel Sofia', 1000, 1, '15:00', '12:00', 'Set a 5-minute walk from the Serdika underground railway station, the 5-star Grand Hotel Sofia is located right in the heart of Sofia, overlooking the City Garden.
        It offers large rooms, free Wi-Fi and free indoor parking.
        The National Theatre, the Bulgarian National bank and all government institutions are just a few steps away from the Grand Hotel Sofia. The closest metro station is a 5-minute walk away.', '42.69327', '23.33212'),
       (10, '64 Tsarigradsko shosse Blvd', 5, 'Sofia',
        'https://pix8.agoda.net/hotelImages/969/96972/96972_1112230202005330218.jpg?s=1024x768',
        'Metropolitan Hotel Sofia', 1784, 1, '15:00', '12:00', 'Metropolitan Hotel Sofia provides free WiFi, free airport shuttle, upon request and availability and free private parking on site. The relax centre comes with a gym, a sauna and a steam bath.
        The International Expo Centre and Sofia Airport are both set 5 km away and the Mall shopping centre can be reached in a 5-minute walk.
        The stylish air-conditioned rooms offer a free minibar and a free safety deposit box. A flat-screen TV with cable and satellite channels and a work desk are featured as well. The bathroom is equipped with a shower or a bath, free toiletries and a hairdryer.
        Panoramic city views can be enjoyed from all rooms.', '42.69327', '23.33212');


# rooms
INSERT INTO `rooms` (id, room_type, current_price, accommodation_entity_id, description)
VALUES (1, 'single', 135, 1, 'Sleeps one person. Breakfast is included.'),
       (2, 'double', 200, 1, 'Sleeps two people. Breakfast is included.'),
       (3, 'triple', 295, 1, 'Sleeps three people. Breakfast is included.'),
       (4, 'single', 120, 2, 'Sleeps one person. Breakfast is included.'),
       (5, 'double', 200, 2, 'Sleeps two people. Breakfast is included.'),
       (6, 'triple', 260, 2, 'Sleeps three people. Breakfast is included.'),
       (7, 'single', 135, 3, 'Sleeps one person. Breakfast is included.'),
       (8, 'double', 200, 3, 'Sleeps two people. Breakfast is included.'),
       (9, 'triple', 285, 3, 'Sleeps three people. Breakfast is included.'),
       (10, 'single', 135, 4, 'Sleeps one person. Breakfast is included.'),
       (11, 'double', 200, 4, 'Sleeps two people. Breakfast is included.'),
       (12, 'single', 135, 5, 'Sleeps one person. Breakfast is included.'),
       (13, 'double', 200, 5, 'Sleeps two people. Breakfast is included.'),
       (14, 'single', 30, 6, 'Sleeps one person. Breakfast is included.'),
       (15, 'double', 50, 6, 'Sleeps two people. Breakfast is included.'),
       (16, 'triple', 70, 6, 'Sleeps three people. Breakfast is included.'),
       (17, 'single', 80, 7, 'Sleeps one person. Breakfast is included.'),
       (18, 'double', 150, 7, 'Sleeps two people. Breakfast is included.'),
       (19, 'single', 65, 8, 'Sleeps one person. Breakfast is included.'),
       (20, 'double', 125, 8, 'Sleeps two people. Breakfast is included.'),
       (21, 'single', 100, 9, 'Sleeps one person. Breakfast is included.'),
       (22, 'double', 195, 9, 'Sleeps two people. Breakfast is included.'),
       (23, 'single', 85, 10, 'Sleeps one person. Breakfast is included.'),
       (24, 'double', 165, 10, 'Sleeps two people. Breakfast is included.');


# Booking test
# INSERT INTO `bookings` (id, booking_time, check_out, check_in, email, guest_id, property_id, pet_name,
#                         pet_kilograms)
# VALUES (1, '20:00:00', '2022-01-27', '2022-01-20', 'sisi@abv.bg', 2, 1, 1, 'Bren', 34),
#        (2, '21:00:00', '2022-01-29', '2022-01-28', 'sisi@abv.bg', 2, 1, 1, 'Rocky', 25);

# INSERT INTO `booked_rooms`(id, number_of_rooms, price, booking_id, room_id)
# VALUES (1, 2, 135, 1, 1),
#        (2, 1, 200, 2, 2);

# ==============================================================
# queries
SELECT count(r.id)
FROM bookings as b
         JOIN rooms as r ON b.id = r.id
WHERE r.id = :roomId
  AND r.accommodation_entity_id = :hotelId
  AND b.check_out > :checkIn
  AND b.check_in < :checkOut;

SELECT *
FROM bookings as b
WHERE check_in >= '2022-01-29'
  AND check_out <= '2022-01-30';

# Last
SELECT count(br.id)
FROM bookings as b
         JOIN booked_rooms br on b.id = br.booking_id
WHERE b.property_id = 1
  AND br.room_id = 2
  AND ((b.check_in >= '2022-01-28' AND b.check_in <= '2022-01-29'
    OR (b.check_out > '2022-01-28' AND b.check_out < '2022-01-29')
    OR (b.check_in < '2022-01-28' AND b.check_out > '2022-01-29')));
# ==============================================================

# UPDATE bookings as b
# SET b.cancelled_on = CURRENT_TIMESTAMP
# WHERE b.id = 45;